# 안드로이드 플랫폼 아키텍처 

Android는 다양한 기기와 폼 팩터에 사용할 수 있도록 제작된 **리눅스 기반의 오픈소스 소프트웨어 스택**이다. 아래 그림은 안드로이드 플랫폼의 주요 구성요소를 보여준다.

<img width="600" src="https://github.com/leeeha/Android-TIL/assets/68090939/71ed511e-518a-409e-936f-4a788774aeff"/>

## 리눅스 커널

안드로이드 플랫폼의 기초는 **리눅스 커널**이다. 예를 들어, Android Runtime (ART)은 스레딩 및 하위 수준의 메모리 관리와 같은 기본 기능에 리눅스 커널을 사용한다. 

리눅스 커널을 사용하면 안드로이드에서 주요 보안 기능을 활용할 수 있으며, 기기 제조업체에서 잘 알려진 커널용 하드웨어 드라이버를 개발할 수 있다. 

## 하드웨어 추상화 계층 (HAL)

Hardware Abstraction Layer는 상위 수준의 Java API 프레임워크에 **기기의 하드웨어 기능을 노출하는 표준 인터페이스를 제공**한다. 

HAL은 여러 라이브러리 모듈로 구성되며, 각 모듈은 카메라, 블루투스와 같은 **특정 유형의 하드웨어 구성요소를 위한 인터페이스를 구현**한다. 

상위 수준의 자바 API 프레임워크가 **기기 하드웨어에 액세스 하기 위해 시스템 콜을 호출**하면, 안드로이드 시스템이 해당 **하드웨어 구성요소에 대한 라이브러리 모듈을 로드**한다. 

## 안드로이드 런타임 (ART)

안드로이드 버전 5.0 (API 레벨 21) 이상을 실행하는 기기의 경우, **각 앱은 자체 프로세스와 자체 안드로이드 런타임 (ART) 인스턴스로 실행**된다. 

ART는 DEX (Dalvik Executable) 파일을 실행하여 **저용량 메모리 기기에서 여러 가상 머신을 실행**하도록 작성되었다. DEX 파일은 **안드로이드용으로 특별히 설계된 바이트 코드 포맷**으로, **최소 메모리 공간에 맞게 최적화** 되어 있다. d8 같은 빌드 도구는 자바 소스를 안드로이드 플랫폼에서 실행할 수 있는 DEX 바이트 코드로 컴파일 한다. 

ART의 주요 기능 중 몇 가지는 다음과 같다.

- AOT (Ahead-Of-Time) 및 (Just-In-Time) 컴파일
- 최적화 된 가비지 컬렉션 (GC)
- Android 9 (API 레벨 28) 이상에서는 앱 패키지의 DEX 파일을 더 간결한 기계어 코드로 변환
- 전용 샘플링 프로파일러, 상세 진단 예외 및 오류 보고, watchpoint 설정하여 특정 필드 모니터링 등 향상된 디버깅 기능 지원

참고: AOT vs JIT 

- AOT : 프로그램이 실행되기 전에 미리 소스코드를 컴파일하는 방식
  - 프로그램 실행 시작 시간 단축
  - 상대적으로 낮은 메모리 사용량
  - 플랫폼 독립적 (JVM 설치 필요 X)
- JIT : 프로그램이 실행될 때 동적으로 코드를 컴파일하는 방식
  - 런타임 중에 코드를 동적으로 컴파일, 최적화 → 실행 속도, 전반적인 앱 성능 개선
  - 상대적으로 높은 메모리 사용량
  - 플랫폼 종속적 (JVM 설치 필요 O)

안드로이드 버전 5.0 (API 레벨 21) 이전 버전에서는 Dalvik이 ART 였다. **앱이 ART에서 잘 실행되면 Dalvik에서도 제대로 동작할 수 있지만, 그 반대의 경우 제대로 동작하지 않을 수 있다.** 

안드로이드에는 자바 API 프레임워크가 사용하는 자바 8 언어 기능을 포함하여, 대부분의 자바 프로그래밍 언어 기능을 제공하는 핵심 런타임 라이브러리도 포함되어 있다. 

## 네이티브 C/C++ 라이브러리

ART 및 HAL 같은 많은 핵심 안드로이드 시스템 구성요소 및 서비스는 **C/C++로 작성된 네이티브 라이브러리가 필요한 네이티브 코드에서 빌드**된다.

안드로이드 플랫폼은 **자바 API 프레임워크를 제공하여 이러한 일부 네이티브 라이브러리의 기능을 앱에 노출**한다. 예를 들어, 안드로이드 프레임워크의 Java OpenGL API를 통해 OpenGL ES에 액세스하여 앱에서 2D, 3D 그래픽을 그리고 조작할 수 있는 기능을 추가할 수 있다. 

C/C++ 코드가 필요한 앱을 개발하는 경우, **안드로이드 NDK를 사용**해 네이티브 코드에서 직접 이러한 **네이티브 플랫폼 라이브러리에 액세스** 할 수 있다. 

## Java API 프레임워크

안드로이드 OS의 전체 기능 집합은 **자바 언어로 작성된 API를 통해 접근**할 수 있다. 이러한 API는 핵심 모듈식 시스템 구성요소 및 서비스 재사용을 단순화하여 **안드로이드 앱을 제작하는 데 필요한 기본 요소를 구성**하며, 이러한 기본 요소에는 다음이 포함된다. 

- 기능이 풍부하고 확장 가능한 뷰 시스템: 목록, 그리드, 텍스트 상자, 버튼 및 임베디드 웹 브라우저를 포함하여 앱의 UI를 빌드하는 데 사용할 수 있음.
- Resource Manager: 문자열, 그래픽, 레이아웃 파일 같은 코드가 아닌 리소스에 대한 액세스 제공
- Notification Manager: 모든 앱이 상태 표시줄에 맞춤 알림을 표시할 수 있도록 지원
- Activity Manager: 앱의 수명 주기를 관리하고 공통 navigation back stack 제공
- Content Provider: 앱이 연락처 앱과 같은 다른 앱의 데이터에 액세스하거나 자체 데이터를 공유할 수 있도록 함.

개발자는 안드로이드 **시스템 앱이 사용하는 것과 동일한 프레임워크 API에 대한 전체 액세스 권한**을 가진다. 

## 시스템 어플리케이션

안드로이드는 **이메일, SMS 메시지, 캘린더, 인터넷 검색, 연락처 등**의 주요 앱 세트와 함께 제공된다. 플랫폼에 기본적으로 포함된 앱에는 사용자가 설치하도록 선택하는 앱과 구별되는 특별한 상태가 없다. 따라서, 타사 앱이 사용자의 기본 웹 브라우저, SMS 메신저, 또는 기본 키보드가 될 수 있다. 시스템의 설정 앱과 같은 일부 예외가 적용된다. 

시스템 어플리케이션은 **사용자를 위한 앱으로도 작동**하고, **개발자가 자체 앱에서 액세스 할 수 있는 주요 기능을 제공하기 위해 작동**한다. 예를 들어, 앱에서 SMS 메시지를 전달하도록 하려면, 이 기능을 직접 빌드하지 않아도 된다. 대신 이미 설치된 SMS 앱을 호출하여 지정한 수신자에게 메시지를 전송할 수 있다. 

# 참고자료

https://developer.android.com/guide/platform?hl=ko

https://preludez.tistory.com/8

https://medium.com/write-android/안드로이드-프레임워크-part-2-안드로이드-이해에-필요한-기반-지식-9afc5166b676